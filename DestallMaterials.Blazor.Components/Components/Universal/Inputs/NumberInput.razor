@using DestallMaterials.Blazor.Services
@using DestallMaterials.WheelProtection.Linq

@typeparam TNumber
@inherits BaseInput<TNumber>

@if (IsFraction)
{
    <MudBlazor.MudNumericField Format=Format T="TNumber" ValueChanged="v => OnValueSet(v)" Value="_value" HideSpinButtons />
}
else if (IsWholeNumber)
{
    <MudBlazor.MudNumericField T="TNumber" ValueChanged="v => OnValueSet(v)" Value=_value HideSpinButtons />
}
else
{
    throw new InvalidOperationException($"Invalid number type {typeof(TNumber).FullName}.");
}

@code {
    [Parameter]
    public byte Accuracy { get; set; } = 2;

    string Format => $"F{Accuracy}";

    static readonly IEnumerable<Type> WholeNumbers = new Type[]
    {
        typeof(byte), typeof(int), typeof(uint), typeof(long), typeof(ulong), typeof(short), typeof(ushort),
        typeof(byte?), typeof(int?), typeof(uint?), typeof(long?), typeof(ulong?), typeof(short?), typeof(ushort?)
    };

    static readonly IEnumerable<Type> FractionalNumbers = new Type[]
    {
        typeof(float), typeof(double), typeof(decimal),
        typeof(float?), typeof(double?), typeof(decimal?)
    };

    static readonly bool IsFraction = typeof(TNumber).IsOneOf(FractionalNumbers);
    static readonly bool IsWholeNumber = typeof(TNumber).IsOneOf(WholeNumbers);

}