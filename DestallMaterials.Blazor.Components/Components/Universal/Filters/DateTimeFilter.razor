@using DestallMaterials.Blazor.Components.Universal.Inputs

@inherits LeftRightLimitPropertyFilter<DateTime>

<Flag disabled="@(LimitErrored)" Value="Filters" OnValueSet="v=>{ Filters = v; OnFilterChange(); }" />

<DateTimeInput 
    OnValueSet="v => { Value = new(Value) { Left = v }; OnLimitChanged(); }" 
    InputLabel="fromLabel" 
    InvalidityCondition="s => invalidityConditionForInputs(LimitErrored)" 
    Value="Value.Left" />

<DateTimeInput 
    OnValueSet="v => { Value = new(Value) { Right = v }; OnLimitChanged(); }" 
    InvalidityCondition="s => invalidityConditionForInputs(LimitErrored)" 
    InputLabel="toLabel" 
    Value="Value.Right" />


@code {
    void OnLimitChanged()
    {
        if (Value.Left == default && Value.Right == default)
        {
            Filters = false;
            return;
        }

        if (Value.Right == default)
        {
            Value = new(Value) { Right = default };
        }
        else if (Value.Left == default)
        {
            Value = new(Value) { Left = default };
        }
        else
        {
            Filters = true;
        }
        OnFilterChange();

    }

    string invalidityConditionForInputs(bool error) => error ? "Invalid input." : "";

    string fromLabel => $"{InputLabel}: from";
    string toLabel => $"{InputLabel}: to";

}